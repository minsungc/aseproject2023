{"author":"ejgallego","number":316,"diff_summary":[{"file":".gitignore","status":"A","additions":241,"deletions":0},{"file":".gitlab-ci.yml","status":"A","additions":241,"deletions":0},{"file":"dune-project","status":"A","additions":241,"deletions":0},{"file":"mathcomp/algebra/dune","status":"A","additions":241,"deletions":0},{"file":"mathcomp/all/dune","status":"A","additions":241,"deletions":0},{"file":"mathcomp/character/dune","status":"A","additions":241,"deletions":0},{"file":"mathcomp/dune","status":"A","additions":241,"deletions":0},{"file":"mathcomp/field/dune","status":"A","additions":241,"deletions":0},{"file":"mathcomp/fingroup/dune","status":"A","additions":241,"deletions":0},{"file":"mathcomp/solvable/dune","status":"A","additions":241,"deletions":0},{"file":"mathcomp/ssreflect/dune","status":"A","additions":241,"deletions":0}],"state":"open","open_date":"2019-03-30T17:15:52Z","update_date":"2023-01-11T09:19:38Z","discussion":[{"author":"CohenCyril","date":"2019-04-04T17:18:46Z","comment":"@ejgallego and @gares should this be in 1.8.0 ?"},{"author":"ejgallego","date":"2019-04-04T17:34:57Z","comment":"This is experimental so people interested in the Dune build can run it, I don't think it affects the regular workflow otherwise yet."},{"author":"gares","date":"2019-04-04T17:51:34Z","comment":"This is mostly fine to me (we could merge it) but for the latter opam file. I think know why it is there, but that opam package corresponds to no real opam package. Couldn't we use the real opam packages instead (and use dune's compositional build stuff?)."},{"author":"ejgallego","date":"2019-04-04T17:57:32Z","comment":"> Couldn't we use the real opam packages instead (and use dune's compositional build stuff?).\r\n\r\nYes, in a few days, the compositional stuff is undergoing testing as we speak; so indeed I am fine to wait until I update this PR with the split package support.\r\n"},{"author":"CohenCyril","date":"2019-04-04T18:07:29Z","comment":"Let's target 1.8.1 then! Thanks"},{"author":"CohenCyril","date":"2019-05-21T09:38:18Z","comment":"Hi @ejgallego, could you please write some comments to document the build files, add tests to the CI, and maybe explain how it changes the development process (with coqide? proofgeneral?...)"},{"author":"ejgallego","date":"2019-05-21T13:11:04Z","comment":"Noted, will do @CohenCyril ."},{"author":"gares","date":"2019-11-14T10:19:26Z","comment":"ping. Also, I think that the `synopsis` field should be more precise than that."},{"author":"ejgallego","date":"2019-11-14T11:56:16Z","comment":"This is still waiting on a new Dune release for composition support."},{"author":"ejgallego","date":"2020-03-07T04:50:18Z","comment":"Ok, this is finally working, but needs an unreleased version of dune, hopefully we do a dune release soon.\r\n\r\nNote the large amount of warnings that we have to disable in order to get a clean build. A missing feature for the Coq mode is to support build profiles [that would allow a common set of flags, but I'm unsure we want it here instead of per-lib. A warning cleanup would be nice tho.\r\n\r\n> Hi @ejgallego, could you please write some comments to document the build files, add tests to the CI, and maybe explain how it changes the development process (with coqide? proofgeneral?...)\r\n\r\nI will add a CI build as soon as we get a release version of dune, I'm unsure what to write about the documentation of the build files, as far as I know these are standard and covered properly in both the Coq and dune manual.\r\n\r\nWe will add support to CoqIDE / PG very soon, that will be mostly automatic."},{"author":"affeldt-aist","date":"2020-03-25T15:17:22Z","comment":"The release managers for mathcomp 1.11.0 think that, given the fact that it depends on an unreleased version of dune (as of March 7), this PR could be postponed to milestone 1.12.0. Agreed?"},{"author":"ejgallego","date":"2020-03-25T20:54:05Z","comment":"Hi @affeldt-aist , sure, this is not urgent. Note that this PR just adds support for the dune build, I think there is still a long way before it could be considered to be the default."},{"author":"CohenCyril","date":"2020-08-25T12:09:06Z","comment":"@gares @ejgallego I do not understand the pros and cons. Do you think we could converge towards either a milestone or closure until we have a milestone?"},{"author":"ejgallego","date":"2020-08-25T12:22:31Z","comment":"No particular opinion, I guess that's a matter of preference."},{"author":"CohenCyril","date":"2020-08-26T12:49:21Z","comment":"Then I guess the switch to dune should be discussed at the next mathcomp meeting, and then possibly scheduled for some release. What do you think @ejgallego, @maximedenes, @gares, @erikmd?"},{"author":"ejgallego","date":"2020-08-26T14:16:56Z","comment":"Ok, I've updated the PR. @corwin-of-amber did some testing and found some bugs in Dune, but in principle things should work fine.\r\n\r\nPending stuff here is meta-data for the opam file generation, and reorg / cleanup of files if desired."},{"author":"gares","date":"2020-11-15T17:08:17Z","comment":"As per https://github.com/coq/ceps/pull/48#issuecomment-727585541 this PR is blocked by ocaml/dune#3210 IMO\r\nThere is also the test suite folder which does not seem to be compiled."}],"review_discussion":[{"author":"gares","file":".gitlab-ci.yml","date":"2020-08-26T13:28:29Z","comment":"Do we really need an unreleased version of Dune?"},{"author":"ejgallego","file":".gitlab-ci.yml","date":"2020-08-26T14:03:58Z","comment":"It should work fine with recent versions, but the PR needs updating."},{"author":"ejgallego","file":".gitlab-ci.yml","date":"2020-08-26T14:21:53Z","comment":"Updated."},{"author":"gares","file":"mathcomp/algebra/dune","date":"2020-11-04T09:21:33Z","comment":"The metadata is sketchy, the one in the opam files is much better. Example:\r\n```\r\nsynopsis: \"Mathematical Components Library on Algebra\"\r\ndescription: \"\"\"\r\nThis library contains definitions and theorems about discrete\r\n(i.e. with decidable equality) algebraic structures : ring, fields,\r\nordered fields, real fields,  modules, algebras, integers, rational\r\nnumbers, polynomials, matrices, vector spaces...\r\n\"\"\"\r\n```"},{"author":"gares","file":"mathcomp/algebra/dune","date":"2020-11-04T09:22:14Z","comment":"I guess this metadata is used in order to generate the opam packages, but I may be wrong."},{"author":"ejgallego","file":"mathcomp/algebra/dune","date":"2020-11-04T14:31:54Z","comment":"Oh indeed I didn't go the effort to update the metadata until you folks discussed if this would be accepted. Will fix."},{"author":"ejgallego","file":"mathcomp/algebra/dune","date":"2020-11-13T23:22:36Z","comment":"Ok, meta-data updated, noted that I didn't enable the opam file generation yet as it would overwrite the opam files in the repos."},{"author":"ejgallego","file":"mathcomp/algebra/dune","date":"2020-11-13T23:24:41Z","comment":"Actually the meta-data here is for the META file, which is not relevant here. If we have something similar to META files for Coq one day it would become relevant."},{"author":"gares","file":".gitlab-ci.yml","date":"2022-06-01T19:51:18Z","comment":"Is this branch of dune a requirement?"},{"author":"ejgallego","file":".gitlab-ci.yml","date":"2022-06-02T08:55:24Z","comment":"I guess so, if you want just a developer build (even with native) Dune 2.8 is fine, however, if you want to use Dune in Opam, detection of libraries in `user-contrib` will be in Dune 3.3 only."},{"author":"Alizter","file":"dune-project","date":"2022-06-03T10:52:16Z","comment":"What are the `<>` for? Will you fill these with emails later or something?"},{"author":"Alizter","file":".gitlab-ci.yml","date":"2022-06-05T22:40:51Z","comment":"To be clear, detection of libraries in user-contrib hasn't been implemented yet, only inter-project composition of coq dune projects. Adding deps on installed libs is the next step, but I am not certain if this will make 3.3."},{"author":"gares","file":"dune-project","date":"2022-06-07T09:19:35Z","comment":"The AUTHORS file got emails stripped. Imo `<>` should just be dropped"}],"tags":[],"commits":[{"author":"ejgallego","committer":"ejgallego","hash":"fa60114be6b11268b12053993d28d041fac70946","message":"[build] Preliminary support for building with Dune.\n\nThis PR provides preliminary support for building math-comp with Dune.\n\nWe make each library its own package, so they can be installed\nseparately.","date":"2022-06-01T17:43:09Z"},{"author":"ejgallego","committer":"ejgallego","hash":"55367d8e5fda25ad54dc36d011596b5766dfaced","message":"[gitlab] Temporal CI support for dune.\n\nThis would likely need more work, in particular I'd be good if the\nupstream docker image included it.","date":"2022-06-01T17:44:44Z"},{"author":"ejgallego","committer":"ejgallego","hash":"9887dfa093c039f78acbcc48b69b047be11fbe9c","message":"fixup","date":"2022-06-04T11:42:33Z"}]}