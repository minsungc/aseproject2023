{"author":"pi8027","number":591,"diff_summary":[{"file":".github/workflows/nix.yml","status":"A","additions":1161,"deletions":1197},{"file":".gitlab-ci.yml","status":"A","additions":1161,"deletions":1197},{"file":"CHANGELOG_UNRELEASED.md","status":"A","additions":1161,"deletions":1197},{"file":"mathcomp/Make","status":"A","additions":1161,"deletions":1197},{"file":"mathcomp/Make.test-suite","status":"A","additions":1161,"deletions":1197},{"file":"mathcomp/_CoqProject","status":"A","additions":1161,"deletions":1197},{"file":"mathcomp/algebra/countalg.v","status":"A","additions":1161,"deletions":1197},{"file":"mathcomp/algebra/finalg.v","status":"A","additions":1161,"deletions":1197},{"file":"mathcomp/algebra/ssralg.v","status":"A","additions":1161,"deletions":1197},{"file":"mathcomp/algebra/ssrnum.v","status":"A","additions":1161,"deletions":1197},{"file":"mathcomp/algebra/vector.v","status":"A","additions":1161,"deletions":1197},{"file":"mathcomp/field/falgebra.v","status":"A","additions":1161,"deletions":1197},{"file":"mathcomp/field/fieldext.v","status":"A","additions":1161,"deletions":1197},{"file":"mathcomp/field/galois.v","status":"A","additions":1161,"deletions":1197},{"file":"mathcomp/ssreflect/choice.v","status":"A","additions":1161,"deletions":1197},{"file":"mathcomp/ssreflect/fintype.v","status":"A","additions":1161,"deletions":1197},{"file":"mathcomp/ssreflect/order.v","status":"A","additions":1161,"deletions":1197},{"file":"mathcomp/test_suite/test_regular_conv.v","status":"A","additions":1161,"deletions":1197}],"state":"merged","open_date":"2020-09-10T12:29:19Z","update_date":"2020-10-07T22:35:54Z","discussion":[{"author":"CohenCyril","date":"2020-09-10T12:37:49Z","comment":"I am curious about the new performances..."},{"author":"pi8027","date":"2020-09-10T12:44:48Z","comment":"Yes. It will be nice to have benchmarks, including this commented out proof: https://github.com/math-comp/math-comp/blob/c2e7bad5c95a11f42f9f6d282ee2e5d84e27cbed/mathcomp/field/fieldext.v#L1584-L1592"},{"author":"pi8027","date":"2020-09-10T13:09:02Z","comment":"The source of CI failure seems to be coq/coq#9508 which has been fixed in coq/coq#9509. I see there is a possible fix, but since we are about to drop compatibility with Coq (< 8.10), I would rather stop supporting Coq 8.7 and 8.8."},{"author":"pi8027","date":"2020-09-17T08:47:29Z","comment":"Here are some benchmarking results using Coq 8.12.0:\r\n- MathComp `master` (c2e7bad)\r\n  ```\r\n  make test-suite  1072.06s user 20.45s system 99% cpu 18:19.47 total\r\n  ```\r\n- MathComp `primitive-class-records` (a4cb449)\r\n  ```\r\n  make test-suite  1004.05s user 21.26s system 99% cpu 17:12.96 total\r\n  ```\r\n- Odd order (689f07b) with MathComp `master`\r\n  ```\r\n  make  1323.96s user 11.20s system 99% cpu 22:24.46 total\r\n  ```\r\n- Odd order with MathComp `primitive-class-records`\r\n  ```\r\n  make  1318.69s user 11.22s system 99% cpu 22:18.43 total\r\n  ```\r\n\r\nSo it seems that this PR improves the performance of conversion and/or inference regarding packed classes."},{"author":"CohenCyril","date":"2020-09-17T13:59:10Z","comment":"> Here are some benchmarking results using Coq 8.12.0:\r\n> \r\n> * MathComp `master` ([c2e7bad](https://github.com/math-comp/math-comp/commit/c2e7bad5c95a11f42f9f6d282ee2e5d84e27cbed))\r\n>   ```\r\n>   make test-suite  1072.06s user 20.45s system 99% cpu 18:19.47 total\r\n>   ```\r\n> * MathComp `primitive-class-records` ([a4cb449](https://github.com/math-comp/math-comp/commit/a4cb44953aaf82a3e568e8577ef70cb38f4d9803))\r\n>   ```\r\n>   make test-suite  1004.05s user 21.26s system 99% cpu 17:12.96 total\r\n>   ```\r\n> * Odd order (689f07b) with MathComp `master`\r\n>   ```\r\n>   make  1323.96s user 11.20s system 99% cpu 22:24.46 total\r\n>   ```\r\n> * Odd order with MathComp `primitive-class-records`\r\n>   ```\r\n>   make  1318.69s user 11.22s system 99% cpu 22:18.43 total\r\n>   ```\r\n> \r\n> So it seems that this PR improves the performance of conversion and/or inference regarding packed classes.\r\n\r\nI would rather say the benchmark does not reveal significant impact.\r\nWhat about: https://github.com/math-comp/math-comp/blob/c2e7bad5c95a11f42f9f6d282ee2e5d84e27cbed/mathcomp/field/fieldext.v#L1584-L1592?"},{"author":"pi8027","date":"2020-09-23T07:38:00Z","comment":"> I would rather say the benchmark does not reveal significant impact.\r\n> What about:\r\n> \r\n> https://github.com/math-comp/math-comp/blob/c2e7bad5c95a11f42f9f6d282ee2e5d84e27cbed/mathcomp/field/fieldext.v#L1584-L1592\r\n> \r\n> ?\r\n\r\nIn Coq 8.12 and MathComp `master`, it takes 4.304 seconds. In this PR, it takes 3.284 seconds."},{"author":"CohenCyril","date":"2020-09-25T12:28:58Z","comment":"@ggonthier do you agree?"},{"author":"CohenCyril","date":"2020-09-29T11:28:36Z","comment":"Since merging this PR will make us drop support for Coq < 8.9, I think it should be approved in the next meeting before being merged. But as for me, it's all good."},{"author":"pi8027","date":"2020-10-07T15:57:41Z","comment":"Shall we merge?"}],"review_discussion":[{"author":"pi8027","file":"mathcomp/test_suite/test_regular_conv.v","date":"2020-10-07T08:56:27Z","comment":"I will put some comments to make it clear that which tests fail without primitive class records."}],"tags":[],"commits":[{"author":"pi8027","committer":"pi8027","hash":"ad55cb4128382852370ea53d36f4d21a83274e8b","message":"Turn class_of records into primitive records and get rid of the xclass idiom","date":"2020-10-07T14:23:26Z"},{"author":"pi8027","committer":"pi8027","hash":"a7a8adad88825f2e5396dc8698e0b912550807c6","message":"Add a CHANGELOG entry","date":"2020-10-07T14:23:26Z"}]}