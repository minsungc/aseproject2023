{"author":"ghost","number":58,"diff_summary":[{"file":"mathcomp/ssreflect/plugin/trunk/ssreflect.ml4","status":"M","additions":32,"deletions":34}],"state":"merged","open_date":"2016-08-24T09:18:51Z","update_date":"2016-08-24T20:50:41Z","discussion":[{"author":"gares","date":"2016-08-24T12:47:18Z","comment":"Thanks for the PR!\n"},{"author":"ghost","date":"2016-08-24T15:31:52Z","comment":"I've added a commit  https://github.com/math-comp/math-comp/pull/58/commits/6bc53af07a100aad305393edb14c4a3d73b3e3b7 which addresses the code duplication that you pointed out.\n\nConsequences:\n\n**(1)**\n\nThis:\n\n``` Ocaml\nbo <> None\n```\n\nwas replaced with:\n\n``` Ocaml\nNamedDecl.is_local_def decl\n```\n\nThe first version works flawlessly.\n\nThe second version likewise, but there is an additional bonus;\n(for those ones who read the code, not for those ones who have written it) :\nit is obvious what that condition actually means.\n\n**(2)**\n\nThis:\n\n``` Ocaml\nlet _, bo, ty = Named.Declaration.to_tuple (pf_get_hyp gl x) in\nmkProd_or_LetIn (mk_reldecl (Name (f x)) bo ty) (subst_var x c)\n```\n\nwas replaced with:\n\n``` Ocaml\nlet decl = pf_get_hyp gl x in\nmkProd_or_LetIn (decl |> NamedDecl.to_rel |> RelDecl.set_name (Name (f x)))\n                (subst_var x c)\n```\n\nThe only point here is that we drop conversion `to_tuple`.\nSo, instead of converting named-declaration to tuple which was then converted to rel-declaration,\nwe convert named-declaration directly to rel-declaration.\n"},{"author":"gares","date":"2016-08-24T20:50:48Z","comment":"thanks\n"}],"review_discussion":[{"author":"gares","file":"mathcomp/ssreflect/plugin/trunk/ssreflect.ml4","date":"2016-08-24T12:45:57Z","comment":"Sorry but I don't like such duplication of code, this is why I did not merge this part of your previous pull request (and defined the mk_reldecl function).\n"}],"tags":[],"commits":[{"hash":"c353aa577c4bed12746dc8433b5daba31ebd7759","message":"use a convenient module alias instead of \"Context.Rel.Declaration\" and \"Context.Named.Declaration\"","date":"2016-08-17T10:46:16Z"},{"hash":"2bc134ff7c90bbc63ff388d2a456f154cc563ed7","message":"Removing calls of \"Context.Named.Declaration.to_tuple\" function","date":"2016-08-17T11:10:41Z"},{"hash":"6bc53af07a100aad305393edb14c4a3d73b3e3b7","message":"Possible code compaction motivated by Enrico's remark:  https://github.com/math-comp/math-comp/pull/58#discussion_r76048943","date":"2016-08-24T14:22:44Z"}]}